<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" layout:decorator="layout">
<body>
	<div class="top-bar clearfix" layout:fragment="page_header_container">
		<!-- Page-header start -->
		<div class="page-header card">
			<div class="row align-items-end">
				<div class="col-lg-8">
					<div class="page-header-title">
						<i class="fa fa-twitter bg-twiter"></i>
						<div class="d-inline">
							<h4>Twitter蠎�蜻翫��譁ｰ隕丈ｽ懈��</h4>
							<strong class="text-danger">窶ｻ縺ｮ鬆�逶ｮ縺ｯ縲∝ｿ�鬆磯��逶ｮ縺ｧ縺吶��</strong>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Page-header end -->

	<!-- Page body start -->
	<div layout:fragment="page_body_container">
		<form th:action="@{/twitter/completeAds}" method="Post" th:object="${twitterAdsInputForm}" enctype="multipart/form-data" onsubmit="return check('')">
			<div th:replace="common/errorMessages"></div>
			<div class="card">
				<div class="card-block">
					<h4 class="sub-title">繝�繝ｳ繝励Ξ繝ｼ繝磯∈謚�</h4>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">繝�繝ｳ繝励Ξ繝ｼ繝亥錐</label>
						</div>
						<div class="col-sm-8">
							<select class="form-control select" th:field="*{templateId}" onchange="refreshVal()">
								<option th:each="twitterTemplateDto : *{templateList}" th:value="${twitterTemplateDto.getTemplateId()}" th:text="${twitterTemplateDto.getTemplateName()}">繧ｯ繝ｪ繝�繧ｯ驥崎ｦ�</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="card">
				<div class="card-block">
					<h4 class="sub-title">譯井ｻｶ菴懈��</h4>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">譯井ｻｶ蜷�<span class="text-danger">窶ｻ</span></label>
						</div>
						<div class="col-sm-8">
							<input type="text" class="form-control" th:field="*{campaignName}" required maxlength="60" />
						</div>
					</div>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">驟堺ｿ｡髢句ｧ区律<span class="text-danger">窶ｻ</span></label>
						</div>
						<div class="col-sm-8">
							<input type="date" class="form-control" th:field="*{startTime}" required="required" />
						</div>
					</div>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">驟堺ｿ｡邨ゆｺ�譌･<span class="text-danger">窶ｻ</span></label>
						</div>
						<div class="col-sm-8">
							<input type="date" class="form-control" th:field="*{endTime}" required="required" />
						</div>
					</div>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">譌･蛻･莠育ｮ�<span class="text-danger">窶ｻ</span></label>
						</div>
						<div class="col-sm-8">
							<input type="number" class="form-control" th:field="*{dailyBudget}" onkeyup="this.value=this.value.replace(/\D/g,'')" min="1" max="9999999999" required="required" />
						</div>
						<span class="col-form-label">蜀�</span>
					</div>
					<div class="form-group row">
						<div class="col-sm-2 text-right">
							<label class="col-form-label">邱丈ｺ育ｮ�</label>
						</div>
						<div class="col-sm-8">
							<input type="number" class="form-control" onkeyup="this.value=this.value.replace(/\D/g,'')" min="1" th:field="*{totalBudget}" />
						</div>
						<span class="col-form-label">蜀�</span>
					</div>
				</div>
				<div class="card-block">
					<h4 class="sub-title">蠎�蜻頑軸霈画婿蠑�</h4>
					<div class="form-radio">
						<div class="form-group row">
							<label class="col-sm-2 col-form-label text-right">譯井ｻｶ逶ｮ逧�<span class="text-danger">窶ｻ</span></label>
							<th:block th:each="object,stat: ${T(jp.acepro.haishinsan.enums.TwitterObjective).values()}">
								<label class="col-sm-2 col-form-label text-right" th:if="${!stat.first}"></label>
								<div class="radio col-sm-10 col-form-label">
									<label><input type="radio" name="radio" th:value="${object.value}" th:field="*{objective}" th:text="${object.label}" /><i class="helper"></i></label>
								</div>
							</th:block>
						</div>
					</div>
				</div>
				<div class="card-block">
					<h4 class="sub-title">
						繝�繧､繝ｼ繝郁ｨｭ螳�<span class="text-danger">窶ｻ</span>
					</h4>
					<!-- Scrolling DataTable table start -->
					<div id="websiteTwitter" class="dt-responsive table-responsive">
						<table id="basicTable" class="table table-striped table-bordered nowrap" style="width: 100%;">
							<thead>
								<tr>
									<th></th>
									<th>繝�繧､繝ｼ繝医Ξ繝薙Η繝ｼ</th>
									<th>繝�繧､繝ｼ繝亥��螳ｹ</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th></th>
									<th>繝�繧､繝ｼ繝医Ξ繝薙Η繝ｼ</th>
									<th>繝�繧､繝ｼ繝亥��螳ｹ</th>
								</tr>
							</tfoot>
							<tbody>
								<tr th:each="websiteTweet : *{websiteTweetList}">
									<td><input type="checkbox" name="tweetIdList" th:value="${websiteTweet.tweetId}" autocomplete="off" tabindex="-1" data-row="0" data-col="2"></td>
									<td><a th:href="${websiteTweet.previewUrl}" target="_blank">繝励Ξ繝薙Η繝ｼ</a></td>
									<td th:utext="${websiteTweet.tweetTitle} + '&lt;br /&gt;' + ${websiteTweet.tweetBody}">Tiger Nixon</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="followersTwitter" class="dt-responsive table-responsive">
						<table id="basicTable1" class="table table-striped table-bordered nowrap" style="width: 100%;">

							<thead>
								<tr>
									<th></th>
									<th>繝�繧､繝ｼ繝医Ξ繝薙Η繝ｼ</th>
									<th>繝�繧､繝ｼ繝亥��螳ｹ</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th></th>
									<th>繝�繧､繝ｼ繝医Ξ繝薙Η繝ｼ</th>
									<th>繝�繧､繝ｼ繝亥��螳ｹ</th>
								</tr>
							</tfoot>
							<tbody>
								<tr th:each="followersTweet : *{followersTweetList}">
									<td><input type="checkbox" name="tweetIdList" th:value="${followersTweet.tweetId}" autocomplete="off" tabindex="-1" data-row="0" data-col="2"></td>
									<td><a th:href="${followersTweet.previewUrl}" target="_blank">繝励Ξ繝薙Η繝ｼ</a></td>
									<td th:utext="${followersTweet.tweetTitle} + '&lt;br /&gt;' + ${followersTweet.tweetBody}">Tiger Nixon</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<!-- Scrolling DataTable table end -->

				<div class="card-block">
					<h4 class="sub-title">繧ｿ繝ｼ繧ｲ繝�繝郁ｨｭ螳�</h4>
					<div class="form-radio">
						<div class="form-group row">
							<label class="col-sm-2 col-form-label text-right">蝨ｰ蝓�<span class="text-danger">窶ｻ</span></label>
							<th:block th:each="object,stat: ${T(jp.acepro.haishinsan.enums.TwitterLocationType).values()}">
								<label class="col-sm-2 col-form-label text-right" th:if="${!stat.first}"></label>
								<div class="radio col-sm-10 col-form-label">
									<label><input type="radio" name="radio" th:value="${object.value}" th:field="*{location}" th:text="${object.label}" /><i class="helper"></i></label>
								</div>
							</th:block>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 col-form-label text-right"></label>
						<div id="div_select" style="display: none">
							<select class="searchable" multiple='multiple' th:field="*{regions}">
								<option th:each="object : ${T(jp.acepro.haishinsan.service.CodeMasterServiceImpl).twitterRegionList}" th:value="${object.getFirst()}" th:text="${object.getSecond()}">蛹玲ｵｷ驕�</option>
							</select>
						</div>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-sm-12 text-center">
						<button class="btn btn-success" type="submit" sec:authorize="hasAuthority('TWITTER_CAMPAIGN_MANAGE')" th:formaction="@{/twitter/completeAds}" th:formmethod="Post">遒ｺ隱�</button>
					</div>
				</div>
			</div>
		</form>
	</div>

	<!-- Page body end -->

	<div id="styleSelector"></div>
	<div layout:fragment="custom_resource_body">
		<script th:inline="javascript">
			/*<![CDATA[*/
			
		    var nowTemplateId = $('#templateId').val();
	        function refreshVal(){
	        	var twitterTemplateDtoList = /*[[${twitterTemplateDtoList}]]*/;
	        	var templateId = $('#templateId').val();
	        	var twitterTemplateDto = twitterTemplateDtoList.find(
	        		function(element) {
	        		    return element.templateId == templateId;
	        		}
	        	);
	        	
	            if(window.confirm('繝�繝ｳ繝励Ξ繝ｼ繝医��' + twitterTemplateDto.templateName + '縲阪ｒ菴ｿ逕ｨ縺励※繧ゅｈ繧阪＠縺�縺ｧ縺吶°�ｼ歃r\n繝�繝ｳ繝励Ξ繝ｼ繝医′蛻�繧頑崛繧上ｋ縺ｨ縲∝�･蜉帛��螳ｹ縺ｯ螟画峩縺輔ｌ縺ｾ縺吶��')) { 
	            	// 遒ｺ隱肴凾縺ｮ蜃ｦ逅�
	            	nowTemplateId = $('#templateId').val();
	            	var location = twitterTemplateDto.location;
	            	var comma = ",";
	            	var regions = twitterTemplateDto.regions;
	            	
	            	/* 蜈ｨ蝗ｽ */
	            	if(location == 0){
	            		$('input[value="0"]').prop('checked', true);
	            		$('#regions').multiSelect('deselect_all');
	        	        $('#regions').multiSelect('refresh');
	        	        $('#div_select').hide();
	            	/* 譌･譛ｬ */
	            	}else if(location == 1){
	            		$('input[value="1"]').prop('checked', true);
	            		$('#regions').multiSelect('deselect_all');
	        	        $('#regions').multiSelect('refresh');
	        	        $('#div_select').hide();
	            	/* 驛ｽ驕灘ｺ懃恁 */	
	            	}else{
	            		$('input[value="2"]').prop('checked', true);
	            		$("#regions").val(regions);
	    	        	$('#regions').multiSelect('refresh');
	            		document.getElementById("div_select").style.display="inline-block";
	            	}
	            	/*繧ｭ繝｣繝ｳ繝壹�ｼ繝ｳ菴懈�舌�ｮ驛ｨ蛻�*/
	            	$("#campaignName").val(twitterTemplateDto.campaignName);
	            	$("#startTime").val(twitterTemplateDto.startTime);
	            	$("#endTime").val(twitterTemplateDto.endTime);
	            	$("#dailyBudget").val(twitterTemplateDto.dailyBudget);
	            	$("#totalBudget").val(twitterTemplateDto.totalBudget);
	            } else { 
	            	// 繧ｭ繝｣繝ｳ繧ｻ繝ｫ譎ゅ�ｮ蜃ｦ逅�
		            $('#templateId').val(nowTemplateId); // 蜃ｦ逅�荳ｭ豁｢
	            }
	        }
  
	        $(function(){
	        		//驟堺ｿ｡譌･縺ｮ險ｭ螳壹��驕主悉縺ｯ驕ｸ謚槭〒縺阪↑縺�縺ｫ縺吶ｋ
	        		var toDay = new Date();
		            var year = toDay.getFullYear();
		            var month = toDay.getMonth()+1 < 10 ? "0"+(toDay.getMonth()+1) : (toDay.getMonth()+1);
		            var day = toDay.getDate() < 10 ? "0"+toDay.getDate() : toDay.getDate();
		            $("#startTime").attr("min",year+"-"+month+"-"+day);
		            $("#endTime").attr("min",year+"-"+month+"-"+day);
		            
		            //驕ｸ謚槭＠縺溘ヤ繧､繝ｼ繝医�ｮ繝√ぉ繝�繧ｯ
		            var tweetIdList = /*[[${twitterAdsInputForm.tweetIdList}]]*/;
			        for(var i=0;i<tweetIdList.length;i++){
			        	var objective = $("input[name='objective']:checked").val();
			    	    if(objective == 0){
			    	    	$("#basicTable input:checkbox[value="+tweetIdList[i]+"]").attr("checked","checked");
			    	    }else{
			    	    	$("#basicTable1 input:checkbox[value="+tweetIdList[i]+"]").attr("checked","checked");
			    	    }
			        }
	        });

			/*]]>*/
		</script>
		<script>
	window.onload =function(){
		 
	    $('#websiteTwitter').show();
	    $('#followersTwitter').hide();
	    
	    var objective = $("input[name='objective']:checked").val();
	    if(objective == 0){
	    	$('#websiteTwitter').show();
		    $('#followersTwitter').hide();
	    }else{
	    	$('#followersTwitter').show();
		    $('#websiteTwitter').hide();
	    }
	    
	 	//繝�繧､繝ｼ繝医Μ繧ｹ繝医�ｮ繝上Φ繝峨Λ
        $(document).ready(function() {
        $('[name="objective"]:radio').change(function() {
			if ($('[id=objective1]').prop('checked')) {
		        $('#followersTwitter').hide(0,refreshTweetList);
		        $('#websiteTwitter').show();
			}
			if ($('[id=objective2]').prop('checked')) {
			    $('#websiteTwitter').hide(0,refreshTweetList);
			    $('#followersTwitter').show();
			}
		});
        
      	//Data refresh
        function refreshTweetList(){
        	$("#basicTable input[type='checkbox']").each(function(){this.checked=false;});
        	$("#basicTable1 input[type='checkbox']").each(function(){this.checked=false;});
        }
        });
        
		//蝨ｰ蝓溘Λ繧ｸ繧ｪ繝懊ち繝ｳ縺ｮ蛻晄悄迥ｶ諷九ｒ蛻､譁ｭ
        $(document).ready(function() {
        	var location = $("input[name='location']:checked").val();
        	if(location == 2){
        		$('#div_select').show();
        	}
        }); 
		
		//蝨ｰ蝓溘Λ繧ｸ繧ｪ繝懊ち繝ｳ縺ｮ繝上Φ繝峨Λ
        $(document).ready(function() {
        $('[name="location"]:radio').change(function() {
			if ($('[id=location1]').prop('checked')) {
		        $('#div_select').hide(0,refreshData);
			}
			if ($('[id=location2]').prop('checked')) {
			    $('#div_select').hide(0,refreshData);
			}
			if ($('[id=location3]').prop('checked')) {
				$('#div_select').show();
			}
		});
        
        //Data refresh
        function refreshData(){
        	$('#regions').multiSelect('deselect_all');
	        $('#regions').multiSelect('refresh');
        }
        
        });
	}
	</script>
	</div>
</body>
</html>