<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" layout:decorator="layout">
<body>
	<div class="top-bar clearfix" layout:fragment="page_header_container">
		<!-- Page-header start -->
		<div class="page-header card">
			<div class="row align-items-end">
				<div class="col-lg-8">
					<div class="page-header-title">
						<i class="fa fa-google bg-googleplus"></i>
						<div class="d-inline">
							<h4>Google蠎�蜻� 譯井ｻｶ荳�隕ｧ</h4>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Page-header end -->

	<!-- Page body start -->
	<div layout:fragment="page_body_container">
		<form th:action="@{/}" method="post">
			<div class="card">
				<div class="card-block">
					<div class="dt-responsive table-responsive">
						<input type="hidden" class="js-single">
						<table id="basicTable" class="table table-striped table-hover table-bordered nowrap" style="width: 100%;">
							<thead>
								<tr>
									<th>繧ｹ繝�繝ｼ繧ｿ繧ｹ</th>
									<th>蟇ｩ譟ｻ迥ｶ豕�</th>
									<th>譯井ｻｶID</th>
									<th>譯井ｻｶ蜷�</th>
									<th>蠎�蜻翫ち繧､繝�</th>
									<th>驟堺ｿ｡髢句ｧ区律</th>
									<th>驟堺ｿ｡邨ゆｺ�譌･</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th>繧ｹ繝�繝ｼ繧ｿ繧ｹ</th>
									<th>蟇ｩ譟ｻ迥ｶ豕�</th>
									<th>譯井ｻｶID</th>
									<th>譯井ｻｶ蜷�</th>
									<th>蠎�蜻翫ち繧､繝�</th>
									<th>驟堺ｿ｡髢句ｧ区律</th>
									<th>驟堺ｿ｡邨ゆｺ�譌･</th>
								</tr>
							</tfoot>
							<tbody>
								<tr th:each="campaign : ${googleCampaignInfoDtoList}">
									<td><label hidden="hidden" th:text="${campaign.campaignId}"></label> <input type="checkbox" class="js-switch" th:checked="${campaign.campaignStatus} == 'ENABLED'" th:disabled="${(campaign.approvalFlag == T(jp.acepro.haishinsan.enums.ApprovalFlag).WAITING.getValue()) && !(T(jp.acepro.haishinsan.util.ContextUtil).hasAuthority('CAMPAIGN_APPROVAL'))}"></td>
									<td th:text="${T(jp.acepro.haishinsan.enums.ApprovalFlag).of(campaign.approvalFlag).getLabel()}">謇ｿ隱榊ｾ�縺｡</td>
									<td><a th:text="${campaign.campaignId}" th:href="@{/google/detailCampaign(campaignId=${campaign.campaignId})}">00000001</a></td>
									<td th:text="${campaign.campaignName}">繧ｭ繝｣繝ｳ繝壹�ｼ繝ｳ�ｼ�</td>
									<td th:text="${T(jp.acepro.haishinsan.enums.GoogleAdType).of(campaign.adType).getLabel()}">繝ｬ繧ｹ繝昴Φ繧ｷ繝門ｺ�蜻�</td>
									<td th:text="${campaign.startDateSlash}">2018/10/01</td>
									<td th:text="${campaign.endDateSlash}">2018/10/31</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</form>
	</div>
	<!-- Page body end -->
	<div layout:fragment="custom_resource_body">
		<script type="text/javascript">
		
		    // 逡ｰ蟶ｸ逋ｺ逕溘ヵ繝ｩ繧ｰ繧貞�晄悄蛹�
		    // 豈主屓繧ｹ繧､繝�繝√ｒ繧ｯ繝ｪ繝�繧ｯ縺吶ｋ蜑阪↓螳溯｡�
		    var apiError = false;
		    
			$(":checkbox").change(
				function() {
	
					// 逡ｰ蟶ｸ逋ｺ逕溘＠縺ｪ縺�蝣ｴ蜷医�∝�ｦ逅�繧堤ｶ壹¢繧�
					// 逡ｰ蟶ｸ逋ｺ逕溘＠縺溷�ｴ蜷医�ｯ縲∫焚蟶ｸ繝輔Λ繧ｰ繧偵Μ繧ｻ繝�繝�
					if (apiError) {
						apiError = false;
						return;
					}
					
					// 繧ｭ繝｣繝ｳ繝壹�ｼ繝ｳID繧定ｨｭ螳�
				    var campaignId = $(this).prev().text();
					
					// 蜍穂ｽ懊ヵ繝ｩ繧ｰ繧定ｨｭ螳�
				    var switchFlag = "";
					if ($(this).prop('checked')) {
				        switchFlag = "ON"; 縲�縲�// OFF縺ｫ縺吶ｋ
					} else {
						switchFlag = "OFF"; // ON縺ｫ縺吶ｋ
					}

					// WEBAPI縺ｮURL險ｭ螳�
					var urlStr = "/google/api/"縲�+ campaignId + "/"縲�+ switchFlag;
					
					//縲�蟇ｩ譟ｻ迥ｶ豕・lement繧貞叙蠕�
					var approval = $(this).parent().next();
					
					// 繧ｹ繧､繝�繝・lement繧貞叙蠕�
					var checkBox = $(this);
					
					// 繧ｹ繝�繝ｼ繧ｿ繧ｹ譖ｴ譁ｰ繧貞ｮ滓命
					$.ajax({
						url : urlStr,
                        success : function(result) {
                        	
                        	// 蟇ｩ譟ｻ迥ｶ豕・lement縺ｮ陦ｨ遉ｺ蜀�螳ｹ繧貞､画峩
							if (approval.text() == "謇ｿ隱榊ｾ�縺｡" && switchFlag == "ON") {
								approval.text("謇ｿ隱肴ｸ医∩");
				            }
                        	
							//縲�繝�繝ｼ繝悶Ν蜀�螳ｹ縺悟叉譎ゅΜ繝輔Ξ繝�繧ｷ繝･
							$("#basicTable").DataTable();
							
							// 豁｣蟶ｸ邨ゆｺ�譎ゅ↓繧｢繝ｩ繝ｼ繝郁｡ｨ遉ｺ
							alert("Google蠎�蜻翫�ｮ繧ｹ繝�繝ｼ繧ｿ繧ｹ縺梧峩譁ｰ縺輔ｌ縺ｾ縺励◆�ｼ�");	
                        },
                        error : function(result) {
							
							// Change Function縺ｮ辟｡髯舌Ν繝ｼ繝励ｒ縺励↑縺�縺溘ａ縺ｫ縲√��
							//縲�逡ｰ蟶ｸ逋ｺ逕滓凾縺ｫ逡ｰ蟶ｸ繝輔Λ繧ｰ險ｭ螳�
                        	apiError = true;	
							
							// 逡ｰ蟶ｸ邨ゆｺ�譎ゅ↓繧｢繝ｩ繝ｼ繝郁｡ｨ遉ｺ
							alert("逡ｰ蟶ｸ逋ｺ逕溘＠縺溘◆繧√�；oogle蠎�蜻翫�ｮ繧ｹ繝�繝ｼ繧ｿ繧ｹ縺梧峩譁ｰ縺ｧ縺阪∪縺帙ｓ縺ｧ縺励◆�ｼ�");
							
							// 繧ｹ繧､繝�繝√�ｮ迥ｶ諷九ｒ繧ｯ繝ｪ繝�繧ｯ蜑阪↓謌ｻ縺吶→縺ｨ繧ゅ↓縲�
							//縲�Change Function繧貞�榊ｺｦ逋ｺ轣ｫ縺吶ｋ縺溘ａ縲∫┌髯舌Ν繝ｼ繝励↓縺ｪ繧�
							checkBox.click();

                        }
					});
				}
			);
		</script>
	</div>
</body>
</html>